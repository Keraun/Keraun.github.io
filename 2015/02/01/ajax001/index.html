
<!DOCTYPE html>
<html lang="zh-Hans">
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="hexo">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="author" content="iwuly">
	
        <link rel="icon" href="/static/images/favicon.png">
    
    
    
    	<meta name="keyword" content="Ajax,javaScript">
    
    
    	<meta name="description" content="前言前段时间群里做知识分享,大豹老师分享了他对Ajax的一些心得体会,当时听的比较入迷,整理了一些笔记,希望对大家有帮助。知识目录结构Ajax基础知识jQuery中Ajax的相关用法jQuery中Ajax全局设置和全局事件表单数据序列化实际应用中的注意事项知识扩展">
    
	<title>Study notes: Ajax - iwulyの前端小站</title>
	<link rel="stylesheet" href="/static/css/style.css" type="text/css">
</head>
<body>



<nav  id="sidebar" class=" behavior_2">
    <div class="wrap">
    	
    		<div class="profile">
    			<a href="/"><img src="/static/images/gravatar.jpg" alt="iwuly"></a>
    			<span>iwuly</span>
    		</div>
    	
    	
    		<ul class="buttons">
    			
    				<li>
                        <a  class="" href="/">
                            
                                <i class="iconfont icon-home" title="首页"></i>
                            
                            <span>首页</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  class="" href="/archive/">
                            
                                <i class="iconfont icon-archive" title="归档"></i>
                            
                            <span>归档</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  class="" href="/tags/">
                            
                                <i class="iconfont icon-tags" title="标签"></i>
                            
                            <span>标签</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  class="" href="/about/">
                            
                                <i class="iconfont icon-user" title="关于"></i>
                            
                            <span>关于</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  class="" href="/links/">
                            
                                <i class="iconfont icon-link" title="友链"></i>
                            
                            <span>友链</span>
                        </a>
                    </li>
    			
    		</ul>
    	
    		<ul class="buttons">
    			
    				<li>
                        <a  target="_blank"  class="" href="http://iwuly.github.io/snippets">
                            
                                <i class="iconfont icon-stackoverflow" title="Demo"></i>
                            
                            <span>Demo</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  target="_blank"  class="" href="https://github.com/iwuly">
                            
                                <i class="iconfont icon-github" title="GitHub"></i>
                            
                            <span>GitHub</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  target="_blank"  class="" href="http://weibo.com/AntelopeWu">
                            
                                <i class="iconfont icon-weibo" title="微博"></i>
                            
                            <span>微博</span>
                        </a>
                    </li>
    			
    				<li>
                        <a  class="" href="mailto:iwuly93@163.com">
                            
                                <i class="iconfont icon-mail" title="邮箱"></i>
                            
                            <span>邮箱</span>
                        </a>
                    </li>
    			
    		</ul>
    	
    		<ul class="buttons">
    			
    				<li>
                        <a  class="" href="/atom.xml">
                            
                                <i class="iconfont icon-rss" title="RSS"></i>
                            
                            <span>RSS</span>
                        </a>
                    </li>
    			
    		</ul>
    	
    </div>
</nav>


<div id="main">
    
<div id="header">
	<div class="btn-bar"><i></i></div>
	<h1><a href="/">iwulyの前端小站</a></h1>
	<a class="me" href="/about/">
        <img src="/static/images/gravatar.jpg" alt="iwuly" alt="iwuly">
    </a>
</div>
<div id="sidebar-mask"></div>
    <div class="wrap">
        <div id="page-post">
        	<article class="markdown">
				<h1>
					
                        Study notes: Ajax
                    
				</h1>
				<p class="note-tags">
					
                        <a  href="/tags/Ajax" data-tag="ajax">
                            <code class="notebook">Ajax</code>
                        </a>
                    
                        <a  href="/tags/javaScript" data-tag="javascript">
                            <code class="notebook">javaScript</code>
                        </a>
                    
				</p>
				<div class="content">
					<h4 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>前段时间群里做知识分享,<a href="http://www.cnblogs.com/lvdabao/" target="_blank" rel="external">大豹</a>老师分享了他对Ajax的一些心得体会,当时听的比较入迷,整理了一些笔记,希望对大家有帮助。</p>
</blockquote>
<h4 id="u77E5_u8BC6_u76EE_u5F55_u7ED3_u6784"><a href="#u77E5_u8BC6_u76EE_u5F55_u7ED3_u6784" class="headerlink" title="知识目录结构"></a>知识目录结构</h4><ul>
<li>Ajax 基础知识</li>
<li>jQuery中Ajax的相关用法</li>
<li>jQuery中Ajax全局设置和全局事件</li>
<li>表单数据序列化</li>
<li>实际应用中的注意事项</li>
<li>知识扩展<a id="more"></a>
</li>
</ul>
<h3 id="1-1_ajax_u662F_u4EC0_u4E48"><a href="#1-1_ajax_u662F_u4EC0_u4E48" class="headerlink" title="1.1 ajax是什么"></a>1.1 ajax是什么</h3><p>Ajax:<br>Asyncronous javascript And XML<br>异步的        JavaScript 和 XML</p>
<h3 id="1-2__u540C_u6B65_u548C_u5F02_u6B65"><a href="#1-2__u540C_u6B65_u548C_u5F02_u6B65" class="headerlink" title="1.2 同步和异步"></a>1.2 同步和异步</h3><p>javascript是单线程的，代码始终自上往下依次执行。<br>可以异步执行的代码：ajax、setTimeout、setInterval。</p>
<h3 id="1-3__u5F02_u6B65_u8BF7_u6C42_u6709_u4EC0_u4E48_u7528_u9014_uFF1F"><a href="#1-3__u5F02_u6B65_u8BF7_u6C42_u6709_u4EC0_u4E48_u7528_u9014_uFF1F" class="headerlink" title="1.3 异步请求有什么用途？"></a>1.3 异步请求有什么用途？</h3><p>1、制作单页面应用，用户操作不进行跳转、每次只更新局部内容<br>2、表单即时校验，如文本框失去焦点立即检验<br>3、进行前后端倪分离，后端只关注数据<br>4、定时异步请求（轮询），实现伪实时效果，如在线聊天室<br>5.异步加载多级数据，如树形结构、多级联动菜单、分页<br>6 。。。<br>问题：前端如何处理大数据？<br>解析：前端数据再大，还是要向服务器端请求数据，浏览器还是要解析，其实没法从根本上解决问题。如果你的dom节点多了，浏览器可能就处理不过来，造成浏览器假死现象。<br>一个方案就是：异步加载完这些数据，来进行异步处理，这样可以减轻浏览器的压力。</p>
<h3 id="1-4__u5F02_u6B65_u8BF7_u6C42_u7684_u4F18_u7F3A_u70B9"><a href="#1-4__u5F02_u6B65_u8BF7_u6C42_u7684_u4F18_u7F3A_u70B9" class="headerlink" title="1.4 异步请求的优缺点"></a>1.4 异步请求的优缺点</h3><p>优点：<br> 1.不会阻塞当前正在进行的任务。<br> 2.局部刷新，避免页面跳转，用户体验更好<br> 3.减少请求数据的大小，加载更快<br> 4.有利于前后端分离，后端只关注数据</p>
<p>缺陷：<br> 1.毁坏浏览器前进后退按钮的功能<br> 2.不利于SEO<br> 3.无法跨域</p>
<p>这些都有相应的解决方法</p>
<h3 id="1-5__u8BA4_u8BC6XMLHttpRequest_u5BF9_u8C61"><a href="#1-5__u8BA4_u8BC6XMLHttpRequest_u5BF9_u8C61" class="headerlink" title="1.5 认识XMLHttpRequest对象"></a>1.5 认识XMLHttpRequest对象</h3><p>var xhr = new XMLHttpRequest();<br>console.log(xhr);<br>几个重要的字段，方法。<br>onreadystatechange:null  请求的状态发生变化时的属性<br>readyState:0 请求的状态<br>responseText:”” 服务器返回的东西<br>status:0   对应http状态码<br>原型方法<br>abort() 取消请求。<br>open() 建立一个连接<br>send() 发送请求<br>setRequestHeader() 设置请求头部</p>
<p>textStatus会告诉你error的类型</p>
<h3 id="1-6_u539F_u751Fajax_u5199_u6CD5"><a href="#1-6_u539F_u751Fajax_u5199_u6CD5" class="headerlink" title="1.6原生ajax写法"></a>1.6原生ajax写法</h3><p>请求的5个阶段，对应的readyState的值<br>0：未初始化，send方法未调用<br>1：正在发送请求，send方法已调用<br>2：请求发送完毕，send方法执行完毕<br>3：正在解析响应内容<br>4：响应内容解析完毕</p>
<p>原生XMLHttpRequest不兼容低版本IE（6-）<br>需配合IE6: ActiveXObject(‘Microsoft.XMLHTTP’)<br>IE5: ActiveXObject(‘MSXML2.XMLHTTP’);</p>
<h3 id="2-1_jQuery_u4E2D_u7684ajax"><a href="#2-1_jQuery_u4E2D_u7684ajax" class="headerlink" title="2.1 jQuery中的ajax"></a>2.1 jQuery中的ajax</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.get(rul,[data],[callback],[type])</span><br><span class="line">$.post(url, [data], [callback], [type])</span><br><span class="line">$.getJSON(url, [data], [callback])</span><br><span class="line">$.getScript(url, [callback])</span><br><span class="line">$.fn.load(url, [data], [callback])</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url:<span class="string">'请求地址'</span>,</span><br><span class="line">    type:<span class="string">'GET/POST'</span>,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">true</span>/<span class="literal">false</span>, <span class="comment">//是否异步</span></span><br><span class="line">    data: &#123;&#125;,<span class="comment">//发送的数据</span></span><br><span class="line">    timeout: <span class="string">'5000'</span>,<span class="comment">//超时时间</span></span><br><span class="line">    dataType: <span class="string">'json/xml/html/script/json/jsonp/text'</span></span><br><span class="line">    <span class="comment">//返回的数据格式</span></span><br><span class="line">    beforeSend: <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>)</span>&#123;&#125;,<span class="comment">//发送请求前</span></span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data, textStatus, jqXHR</span>)</span>&#123;&#125;,<span class="comment">//请求成功</span></span><br><span class="line">    error: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus</span>)</span>&#123;&#125;,<span class="comment">//请求失败</span></span><br><span class="line">    complete: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, testStatus</span>)</span>&#123;&#125;,<span class="comment">//请求结束</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>一般我会用$.ajax,因为他稍微更底层一点，可配置性高一点，可控性也高一点，效率也高一些。</p>
<h3 id="3_ajax_u4E2D_u7684_u5168_u5C40_u914D_u7F6E_u548C_u5168_u5C40_u4E8B_u4EF6"><a href="#3_ajax_u4E2D_u7684_u5168_u5C40_u914D_u7F6E_u548C_u5168_u5C40_u4E8B_u4EF6" class="headerlink" title="3 ajax中的全局配置和全局事件"></a>3 ajax中的全局配置和全局事件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">      type: <span class="string">'POST'</span>,</span><br><span class="line">      timeout:<span class="string">'6000'</span>,</span><br><span class="line">      data: &#123;name: <span class="string">'abc'</span>&#125;,</span><br><span class="line">      dataType: <span class="string">'json'</span>,</span><br><span class="line">      beforSend: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'loading...'</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          alert(<span class="string">'请求失败，请重试！'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ajaxStart(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* Stuff to do when an AJAX call is started and no other AJAX calls are in progress */</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ajaxSend(<span class="function"><span class="keyword">function</span>(<span class="params">event, xhr, settings</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* stuff to do before an AJAX request is sent */</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ajaxSuccess(<span class="function"><span class="keyword">function</span>(<span class="params">event, xhr, settings</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* executes whenever an AJAX request completes successfully */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ajaxError(<span class="function"><span class="keyword">function</span>(<span class="params">event, xhr, settings, thrownError</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* Stuff to do when an AJAX call returns an error */</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ajaxComplete(<span class="function"><span class="keyword">function</span>(<span class="params">event, xhr, settings</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* executes whenever an AJAX request completes */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ajaxStop((<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* stuff to do when all AJAX calls have completed */</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-1__u8868_u5355_u6570_u636E_u5E8F_u5217_u5316"><a href="#4-1__u8868_u5355_u6570_u636E_u5E8F_u5217_u5316" class="headerlink" title="4.1 表单数据序列化"></a>4.1 表单数据序列化</h3><p>作用：<br>1.异步提交表单，免去跳转<br>2.快速获取表单数据<br>jQuery中的方法<br>serializ()//序列化为字符串<br>serializeArray()//序列化为数组</p>
<p>这两个不是jQuery中的方法<br>IE7以下需要引入JSON2文件<br>JSON对象呢在HTML5里面已经列为标准了呢。IE6还不能支持。所以还需要依赖JSON2文件<br>JSON.parse()//json字符串转化为json对象<br>JSON.stringify()//json对象转为json字符串</p>
<h4 id="5-1__u51FD_u6570return_u5F02_u6B65_u6570_u636E_uFF0C_u53D6_u4E0D_u5230_u7684_u95EE_u9898"><a href="#5-1__u51FD_u6570return_u5F02_u6B65_u6570_u636E_uFF0C_u53D6_u4E0D_u5230_u7684_u95EE_u9898" class="headerlink" title="5.1 函数return异步数据，取不到的问题"></a>5.1 函数return异步数据，取不到的问题</h4><p>可以设置为同步请求，或者返回promise。<br>5.2同步Ajax请求造成的UI线程阻塞问题<br>一个浏览器嘛，他分为两个引擎，一个是js引擎用来解析你的js代码，比方说chrome的js引擎是v8，UI引擎是webkit，一个浏览器么，一个js引擎，一个ui引擎。这两个是没法同时进行的。一个运行的时候，他会阻塞吊另一个。什么意思呢。发送同步请求的时候，比如2秒钟的时候，js引擎要工作2s钟的时间，他会把ui引擎给阻塞掉，所以gif图片他是需要ui引擎来渲染的，所以他会阻塞掉的。（阻塞时，js，animate照常运行，但是页面呈现出的是2s后的效果）。为什么我们平时感受不到js引擎把UI引擎给阻塞掉了？因为同步的代码是非常快的。第一个例子执行100万次才10几毫秒，所以你感受不到。但是2s种你就能做好多事情。</p>
<h3 id="5-3__u4E3Aajax_u8BBE_u7F6E_u65F6_u95F4_u8D85_u65F6"><a href="#5-3__u4E3Aajax_u8BBE_u7F6E_u65F6_u95F4_u8D85_u65F6" class="headerlink" title="5.3 为ajax设置时间超时"></a>5.3 为ajax设置时间超时</h3><h3 id="5-4__u5224_u65ADerror_u7C7B_u578B"><a href="#5-4__u5224_u65ADerror_u7C7B_u578B" class="headerlink" title="5.4 判断error类型"></a>5.4 判断error类型</h3><p>error的类型可能有：<br>timeout 超时<br>error  获取不到具体错误（请求时浏览器刷新报error错误）<br>notmodified 返回304<br>parsererror 解析xml或json错误<br>abort 请求取消</p>
<h3 id="5-5__u6269_u5C55_u77E5_u8BC6"><a href="#5-5__u6269_u5C55_u77E5_u8BC6" class="headerlink" title="5.5 扩展知识"></a>5.5 扩展知识</h3><ul>
<li>HTML5的XMLHttpRequest2</li>
<li>promise规范和jQuery的Deffered对象</li>
<li>pjax</li>
<li>跨域请求</li>
<li>Fetch</li>
</ul>

				</div>
			</article>
            
                <div class="ds-thread" data-thread-key="2015/02/01/ajax001/"
     data-title="Study notes: Ajax" data-url="http://iwuly.com/2015/02/01/ajax001/">
</div>

            
        </div>
    </div>
</div>

    <script type="text/javascript">
        var duoshuoQuery = {short_name:'iwuly'};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>


<script src="/static/js/meizi.js" type="text/javascript"></script>
</body>
</html>